import{j as e}from"./index-BbHywOFY.js";import{r as s}from"./router-BRn4_cjy.js";import{c as t}from"./client-BgEgIup-.js";import{i as a,R as r,a5 as l,j as i,aW as n,aX as c}from"./ui-TmEHN81D.js";import"./vendor-DtuzQOD1.js";function d(){const[d,o]=s.useState(null),[x,m]=s.useState(!0),[u,h]=s.useState({}),[p,y]=s.useState({}),[g,j]=s.useState(null),[b,f]=s.useState(!1),[v,N]=s.useState("all"),[w,q]=s.useState("");s.useEffect(()=>{(async()=>{try{m(!0);const e=await t.church.listPrayerRequests();o({prayerRequests:e.requests})}catch(e){console.error("Failed to fetch prayer requests:",e),o({prayerRequests:[]})}finally{m(!1)}})()},[b]);const S=async()=>{f(e=>!e)},R=((null==d?void 0:d.prayerRequests)||[]).filter(e=>{if(!e)return!1;if(w){const s=w.toLowerCase();if(!((e.name||"").toLowerCase().includes(s)||(e.email||"").toLowerCase().includes(s)||(e.request||"").toLowerCase().includes(s)))return!1}switch(v){case"urgent":return e.isUrgent;case"private":return e.isPrivate;default:return!0}})||[],C=(null==d?void 0:d.prayerRequests)||[];return e.jsxs("div",{className:"bg-gray-800/50 border border-gray-700 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(a,{className:"h-5 w-5 text-white"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white heading-font",children:"Prayer Requests"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Manage and respond to prayer requests from users."})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Search by name, email, or request content...",value:w,onChange:e=>q(e.target.value),className:"w-full bg-gray-700 border border-gray-600 text-white px-4 py-2 text-sm"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:v,onChange:e=>N(e.target.value),className:"bg-gray-700 border border-gray-600 text-white px-3 py-2 text-sm",children:[e.jsx("option",{value:"all",children:"All Requests"}),e.jsx("option",{value:"urgent",children:"Urgent Only"}),e.jsx("option",{value:"private",children:"Private Only"})]}),e.jsxs("button",{onClick:S,disabled:b,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 text-white px-3 py-2 flex items-center gap-2 disabled:opacity-50",children:[e.jsx(r,{className:"w-4 h-4 "+(b?"animate-spin":"")}),"Refresh"]})]})]}),d&&e.jsxs("div",{className:"text-sm text-gray-400 mb-4",children:["Showing ",R.length," of ",C.length," prayer requests","all"!==v&&` (filtered by ${v})`,w&&` (search: "${w}")`]}),void 0===d?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(r,{className:"w-6 h-6 animate-spin text-gray-400 mr-2"}),e.jsx("p",{className:"text-gray-400",children:"Loading prayer requests..."})]}):0===R.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(a,{className:"w-12 h-12 text-gray-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:w||"all"!==v?"No prayer requests match your filters.":"No prayer requests found."})]}):e.jsx("div",{className:"space-y-4",children:R.map(s=>{var a;return e.jsxs("div",{className:"bg-gray-700/50 border border-gray-600 p-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h3",{className:"text-white font-semibold",children:s.name||"Anonymous"}),s.isUrgent&&e.jsx(l,{className:"h-4 w-4 text-red-400"}),s.isPrivate&&e.jsx(i,{className:"h-4 w-4 text-yellow-400"}),e.jsx("span",{className:"px-2 py-1 text-xs font-semibold rounded "+("answered"===s.status?"bg-green-600 text-white":"praying"===s.status?"bg-blue-600 text-white":"bg-yellow-600 text-white"),children:s.status})]}),e.jsx("p",{className:"text-gray-300 mb-2",children:s.request}),s.email&&e.jsxs("p",{className:"text-gray-400 text-sm",children:["Email: ",s.email]}),s.phone&&e.jsxs("p",{className:"text-gray-400 text-sm",children:["Phone: ",s.phone]}),e.jsxs("p",{className:"text-gray-500 text-xs mt-2",children:["Submitted: ",new Date(s.createdAt).toLocaleString()]})]}),e.jsx("button",{onClick:()=>{return e=s.id,void h(s=>({...s,[e]:!s[e]}));var e},className:"text-gray-400 hover:text-white",children:u[s.id]?e.jsx(n,{className:"h-5 w-5"}):e.jsx(c,{className:"h-5 w-5"})})]}),u[s.id]&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-600",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("textarea",{value:p[s.id]||"",onChange:e=>y(t=>({...t,[s.id]:e.target.value})),placeholder:"Type your reply here...",className:"w-full bg-gray-600 border border-gray-500 text-white px-3 py-2 text-sm min-h-[100px]"}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:()=>(async e=>{var s;if(null==(s=p[e])?void 0:s.trim())try{j(e),await t.church.replyPrayerRequest({id:parseInt(e),responderName:"Admin",responderEmail:"admin@supernaturalimstitute.com",message:p[e]}),y(s=>({...s,[e]:""})),j(null),alert("Reply sent successfully!"),S()}catch(a){console.error("Failed to send reply:",a),alert("Failed to send reply. Please try again."),j(null)}})(s.id),disabled:!(null==(a=p[s.id])?void 0:a.trim())||g===s.id,className:"bg-white text-black hover:bg-gray-200 px-4 py-2 font-semibold uppercase tracking-wide text-sm disabled:opacity-50",children:g===s.id?"Sending...":"Send Reply"})})]})})]},s.id)})})]})}export{d as default};
